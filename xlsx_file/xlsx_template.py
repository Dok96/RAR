import os
import shutil
import logging

def replace_xlsx_with_template(target_path, template_path):
    """
    –ó–∞–º–µ–Ω—è–µ—Ç —Ü–µ–ª–µ–≤–æ–π XLSX-—Ñ–∞–π–ª —à–∞–±–ª–æ–Ω–æ–º –∏–∑ –¥—Ä—É–≥–æ–π –ø–∞–ø–∫–∏.

    :param target_path: –ü—É—Ç—å –∫ —Ü–µ–ª–µ–≤–æ–º—É —Ñ–∞–π–ª—É (–∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å).
    :param template_path: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É-—à–∞–±–ª–æ–Ω—É (–∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –ø–æ–¥–º–µ–Ω—ã).
    """
    try:
        # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ü–µ–ª–µ–≤–æ–π —Ñ–∞–π–ª
        if os.path.exists(target_path):
            print(f"‚ÑπÔ∏è –¶–µ–ª–µ–≤–æ–π —Ñ–∞–π–ª –Ω–∞–π–¥–µ–Ω: {target_path}")
            logging.info(f"‚ÑπÔ∏è –¶–µ–ª–µ–≤–æ–π —Ñ–∞–π–ª –Ω–∞–π–¥–µ–Ω: {target_path}")

            # 2. –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–∫—Ä—ã—Ç—å —Ñ–∞–π–ª, –µ—Å–ª–∏ –æ–Ω –æ—Ç–∫—Ä—ã—Ç
            try:
                # –î–ª—è Windows: –ø—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç–∫—Ä—ã—Ç –ª–∏ —Ñ–∞–π–ª
                if os.name == 'nt':  # Windows
                    os.system(f'taskkill /IM "EXCEL.EXE" /F')  # –ó–∞–∫—Ä—ã–≤–∞–µ–º Excel, –µ—Å–ª–∏ —Ñ–∞–π–ª –æ—Ç–∫—Ä—ã—Ç –≤ –Ω–µ–º
                else:
                    print("‚ö†Ô∏è –ù–∞ –¥—Ä—É–≥–∏—Ö –û–° –∑–∞–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ.")
            except Exception as e:
                print(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–∫—Ä—ã—Ç—å —Ñ–∞–π–ª: {e}")

            # 3. –£–¥–∞–ª—è–µ–º —Ü–µ–ª–µ–≤–æ–π —Ñ–∞–π–ª
            os.remove(target_path)
            print(f"üóëÔ∏è –¶–µ–ª–µ–≤–æ–π —Ñ–∞–π–ª —É–¥–∞–ª–µ–Ω: {target_path}")

        # 4. –ö–æ–ø–∏—Ä—É–µ–º —à–∞–±–ª–æ–Ω –Ω–∞ –º–µ—Å—Ç–æ —Ü–µ–ª–µ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
        shutil.copy(template_path, target_path)
        print(f"‚úÖ –®–∞–±–ª–æ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω: {template_path} -> {target_path}")

    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–º–µ–Ω–µ —Ñ–∞–π–ª–∞: {e}")
        logging.error(f'–æ—à–∏–±–∫–∞ –ø–æ –∑–∞–º–µ–Ω–µ —Ñ–∞–π–ª–∞')